{
  "bug_id": "168268",
  "issue_url": "https://github.com/llvm/llvm-project/issues/168268",
  "bug_type": "crash",
  "base_commit": "7761a89e1230d8ccbb8e6ee15dc14ea74792a53c",
  "knowledge_cutoff": "2025-11-16T13:05:21Z",
  "lit_test_dir": [
    "llvm/test/Transforms/SLPVectorizer"
  ],
  "hints": {
    "fix_commit": "306b5a3d64b4abbfb07bcfb77fadb506da897f16",
    "components": [
      "SLPVectorizer"
    ],
    "bug_location_lineno": {
      "llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp": [
        [
          5340,
          5345
        ],
        [
          5391,
          5396
        ],
        [
          5690,
          5695
        ]
      ]
    },
    "bug_location_funcname": {
      "llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp": [
        "areAllOperandsReplacedByCopyableData",
        "schedule"
      ]
    }
  },
  "patch": "commit 306b5a3d64b4abbfb07bcfb77fadb506da897f16\nAuthor: Alexey Bataev <a.bataev@outlook.com>\nDate:   Sun Nov 16 12:36:52 2025 -0800\n\n    [SLP]Do not consider split nodes, when checking parent PHI-based nodes\n    \n    The compiler should not consider split vectorize nodes, when checking\n    for non-schedulable PHI-based parent nodes. Only pure PHI nodes must be\n      considered, they only can be considered as explicit users, split nodes\n      are not.\n    \n    Fixes #168268\n\ndiff --git a/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp b/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp\nindex 938eacde7548..ff7149044d19 100644\n--- a/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp\n+++ b/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp\n@@ -5340,6 +5340,7 @@ private:\n           bool IsNonSchedulableWithParentPhiNode =\n               TE->doesNotNeedToSchedule() && TE->UserTreeIndex &&\n               TE->UserTreeIndex.UserTE->hasState() &&\n+              TE->UserTreeIndex.UserTE->State != TreeEntry::SplitVectorize &&\n               TE->UserTreeIndex.UserTE->getOpcode() == Instruction::PHI;\n           // Count the number of unique phi nodes, which are the parent for\n           // parent entry, and exit, if all the unique phis are processed.\n@@ -5391,6 +5392,7 @@ private:\n         bool IsNonSchedulableWithParentPhiNode =\n             P.first->doesNotNeedToSchedule() && P.first->UserTreeIndex &&\n             P.first->UserTreeIndex.UserTE->hasState() &&\n+            P.first->UserTreeIndex.UserTE->State != TreeEntry::SplitVectorize &&\n             P.first->UserTreeIndex.UserTE->getOpcode() == Instruction::PHI;\n         auto *It = find(P.first->Scalars, User);\n         do {\n@@ -5690,6 +5692,8 @@ private:\n                   Bundle->getTreeEntry()->doesNotNeedToSchedule() &&\n                   Bundle->getTreeEntry()->UserTreeIndex &&\n                   Bundle->getTreeEntry()->UserTreeIndex.UserTE->hasState() &&\n+                  Bundle->getTreeEntry()->UserTreeIndex.UserTE->State !=\n+                      TreeEntry::SplitVectorize &&\n                   Bundle->getTreeEntry()->UserTreeIndex.UserTE->getOpcode() ==\n                       Instruction::PHI;\n               // Count the number of unique phi nodes, which are the parent for\n",
  "tests": [
    {
      "file": "llvm/test/Transforms/SLPVectorizer/X86/parent-node-split-non-schedulable.ll",
      "commands": [
        "opt -passes=slp-vectorizer -S -slp-threshold=-100 -mtriple=x86_64-unknown-linux-gnu < %s"
      ],
      "tests": [
        {
          "test_name": "<module>",
          "test_body": "\ndefine i32 @main(ptr %c, i32 %0, i1 %tobool4.not, i16 %1) {\n;\nentry:\n  br label %if.end\n\nif.end:\n  %n.0.ph = phi i32 [ 0, %entry ], [ %.us-phi52, %while.cond.preheader ]\n  %b.0.ph = phi i32 [ 0, %entry ], [ %b.2, %while.cond.preheader ]\n  %a.0.ph = phi i32 [ 0, %entry ], [ %a.2, %while.cond.preheader ]\n  br i1 %tobool4.not, label %r, label %if.end9\n\nif.end9:\n  %conv11 = sext i16 %1 to i32\n  br label %r\n\nr:\n  %.us-phi51642 = phi i32 [ 0, %if.end9 ], [ %0, %if.end ]\n  %.us-phi415662 = phi i32 [ 0, %if.end9 ], [ 1, %if.end ]\n  %b.1 = phi i32 [ %conv11, %if.end9 ], [ %b.0.ph, %if.end ]\n  %a.1 = phi i32 [ 1, %if.end9 ], [ 0, %if.end ]\n  %tobool12.not = icmp eq i32 %b.0.ph, 0\n  br i1 %tobool12.not, label %if.end14, label %if.then13\n\nif.then13:\n  br label %if.end14\n\nif.end14:\n  %and = and i32 %n.0.ph, 1\n  %not = xor i32 %and, 1\n  %and17 = and i32 %a.0.ph, 1\n  %not18 = xor i32 %and17, 1\n  %div20 = sdiv i32 %and17, %0\n  %2 = load i32, ptr %c, align 4\n  %3 = xor i32 %2, %div20\n  %and25 = and i32 %0, 1\n  %not26 = xor i32 %and25, 1\n  br label %ah\n\nah:\n  %.us-phi4154 = phi i32 [ 0, %ah ], [ %.us-phi415662, %if.end14 ]\n  %.us-phi52 = phi i32 [ 0, %ah ], [ %.us-phi51642, %if.end14 ]\n  %b.2 = phi i32 [ %b.0.ph, %ah ], [ %b.1, %if.end14 ]\n  %a.2 = phi i32 [ 0, %ah ], [ %a.1, %if.end14 ]\n  %l.1 = phi i32 [ %0, %ah ], [ %not, %if.end14 ]\n  %p16.1 = phi i32 [ 0, %ah ], [ %not18, %if.end14 ]\n  %q.1 = phi i32 [ 0, %ah ], [ %3, %if.end14 ]\n  %r23.1 = phi i32 [ 0, %ah ], [ %not26, %if.end14 ]\n  %add = add i32 %q.1, %l.1\n  %4 = or i32 %add, %p16.1\n  %or27 = or i32 %4, %r23.1\n  store i32 %or27, ptr %c, align 4\n  br i1 %tobool4.not, label %while.cond.preheader, label %ah\n\nwhile.cond.preheader:\n  %call69 = tail call i32 @s(i32 %.us-phi4154)\n  br label %if.end\n}\n\ndeclare i32 @s(i32)"
        }
      ]
    }
  ],
  "issue": {
    "title": "clang crashes on valid code at -O3 on x86_64-linux-gnu: Assertion `UnscheduledDeps >= 0 && \"Expected valid number of unscheduled deps\"' failed",
    "body": "Compiler Explorer: https://godbolt.org/z/vn7WbvGb3\n\nNote\n* fail: trunk\n* work: 21.1.0 and earlier\n\n```\n[513] % clangtk -v\nclang version 22.0.0git (https://github.com/llvm/llvm-project.git 5ed26ade0c585d2a081f23546902f64a0366de19)\nTarget: x86_64-unknown-linux-gnu\nThread model: posix\nInstalledDir: /local/home/suz/suz-local/software/local/clang-trunk/bin\nBuild config: +assertions\nFound candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/11\nFound candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/12\nSelected GCC installation: /usr/lib/gcc/x86_64-linux-gnu/12\nCandidate multilib: .;@m64\nCandidate multilib: 32;@m32\nCandidate multilib: x32;@mx32\nSelected multilib: .;@m64\nFound CUDA installation: /usr/local/cuda, version 12.1\n[514] % \n[514] % clangtk -O3 -c small.c\nclangtk: /local/suz-local/software/clangbuild/llvm-project/llvm/lib/Transforms/Vectorize/SLPVectorizer.cpp:4875: int llvm::slpvectorizer::BoUpSLP::ScheduleData::incrementUnscheduledDeps(int): Assertion `UnscheduledDeps >= 0 && \"Expected valid number of unscheduled deps\"' failed.\nPLEASE submit a bug report to https://github.com/llvm/llvm-project/issues/ and include the crash backtrace, preprocessed source, and associated run script.\nStack dump:\n0.\tProgram arguments: clangtk -I/usr/local/include -I/local/suz-local/software/local/include -O3 -c small.c\n1.\t<eof> parser at end of file\n2.\tOptimizer\n3.\tRunning pass \"function<eager-inv>(drop-unnecessary-assumes,float2int,lower-constant-intrinsics,chr,loop(loop-rotate<header-duplication;no-prepare-for-lto>,loop-deletion),loop-distribute,inject-tli-mappings,loop-vectorize<no-interleave-forced-only;no-vectorize-forced-only;>,drop-unnecessary-assumes,infer-alignment,loop-load-elim,instcombine<max-iterations=1;no-verify-fixpoint>,simplifycfg<bonus-inst-threshold=1;forward-switch-cond;switch-range-to-icmp;switch-to-arithmetic;switch-to-lookup;no-keep-loops;hoist-common-insts;no-hoist-loads-stores-with-cond-faulting;sink-common-insts;speculate-blocks;simplify-cond-branch;no-speculate-unpredictables>,slp-vectorizer,vector-combine,instcombine<max-iterations=1;no-verify-fixpoint>,loop-unroll<O3>,transform-warning,sroa<preserve-cfg>,infer-alignment,instcombine<max-iterations=1;no-verify-fixpoint>,loop-mssa(licm<allowspeculation>),alignment-from-assumptions,loop-sink,instsimplify,div-rem-pairs,tailcallelim,simplifycfg<bonus-inst-threshold=1;no-forward-switch-cond;switch-range-to-icmp;switch-to-arithmetic;no-switch-to-lookup;keep-loops;no-hoist-common-insts;hoist-loads-stores-with-cond-faulting;no-sink-common-insts;speculate-blocks;simplify-cond-branch;speculate-unpredictables>)\" on module \"small.c\"\n4.\tRunning pass \"slp-vectorizer\" on function \"main\"\n #0 0x0000556ecaa7f6c0 llvm::sys::PrintStackTrace(llvm::raw_ostream&, int) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x43d36c0)\n #1 0x0000556ecaa7c37f llvm::sys::RunSignalHandlers() (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x43d037f)\n #2 0x0000556eca9baeb8 CrashRecoverySignalHandler(int) CrashRecoveryContext.cpp:0:0\n #3 0x00007f87cde69520 (/lib/x86_64-linux-gnu/libc.so.6+0x42520)\n #4 0x00007f87cdebd9fc __pthread_kill_implementation ./nptl/./nptl/pthread_kill.c:44:76\n #5 0x00007f87cdebd9fc __pthread_kill_internal ./nptl/./nptl/pthread_kill.c:78:10\n #6 0x00007f87cdebd9fc pthread_kill ./nptl/./nptl/pthread_kill.c:89:10\n #7 0x00007f87cde69476 gsignal ./signal/../sysdeps/posix/raise.c:27:6\n #8 0x00007f87cde4f7f3 abort ./stdlib/./stdlib/abort.c:81:7\n #9 0x00007f87cde4f71b _nl_load_domain ./intl/./intl/loadmsgcat.c:1177:9\n#10 0x00007f87cde60e96 (/lib/x86_64-linux-gnu/libc.so.6+0x39e96)\n#11 0x0000556ecc5fdaba auto void llvm::slpvectorizer::BoUpSLP::BlockScheduling::schedule<llvm::SetVector<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, llvm::SmallVector<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, 0u>, llvm::DenseSet<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, llvm::DenseMapInfo<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, void> >, 0u> >(llvm::slpvectorizer::BoUpSLP const&, (anonymous namespace)::InstructionsState const&, llvm::slpvectorizer::BoUpSLP::EdgeInfo const&, llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, llvm::SetVector<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, llvm::SmallVector<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, 0u>, llvm::DenseSet<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, llvm::DenseMapInfo<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, void> >, 0u>&)::'lambda'(llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, llvm::ArrayRef<llvm::slpvectorizer::BoUpSLP::ScheduleBundle*>)::operator()(llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, llvm::ArrayRef<llvm::slpvectorizer::BoUpSLP::ScheduleBundle*>) const::'lambda'(llvm::SetVector<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, llvm::SmallVector<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, 0u>, llvm::DenseSet<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, llvm::DenseMapInfo<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, void> >, 0u>*, bool)::operator()<llvm::slpvectorizer::BoUpSLP::ScheduleData>(llvm::SetVector<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, llvm::SmallVector<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, 0u>, llvm::DenseSet<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, llvm::DenseMapInfo<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, void> >, 0u>*, bool) const SLPVectorizer.cpp:0:0\n#12 0x0000556ecc5fe7eb void llvm::slpvectorizer::BoUpSLP::BlockScheduling::schedule<llvm::SetVector<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, llvm::SmallVector<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, 0u>, llvm::DenseSet<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, llvm::DenseMapInfo<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, void> >, 0u> >(llvm::slpvectorizer::BoUpSLP const&, (anonymous namespace)::InstructionsState const&, llvm::slpvectorizer::BoUpSLP::EdgeInfo const&, llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, llvm::SetVector<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, llvm::SmallVector<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, 0u>, llvm::DenseSet<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, llvm::DenseMapInfo<llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, void> >, 0u>&)::'lambda'(llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, llvm::ArrayRef<llvm::slpvectorizer::BoUpSLP::ScheduleBundle*>)::operator()(llvm::slpvectorizer::BoUpSLP::ScheduleEntity*, llvm::ArrayRef<llvm::slpvectorizer::BoUpSLP::ScheduleBundle*>) const SLPVectorizer.cpp:0:0\n#13 0x0000556ecc5ffd19 llvm::slpvectorizer::BoUpSLP::BlockScheduling::tryScheduleBundle(llvm::ArrayRef<llvm::Value*>, llvm::slpvectorizer::BoUpSLP*, (anonymous namespace)::InstructionsState const&, llvm::slpvectorizer::BoUpSLP::EdgeInfo const&)::'lambda3'(bool, llvm::slpvectorizer::BoUpSLP::ScheduleBundle&)::operator()(bool, llvm::slpvectorizer::BoUpSLP::ScheduleBundle&) const SLPVectorizer.cpp:0:0\n#14 0x0000556ecc601dc3 llvm::slpvectorizer::BoUpSLP::BlockScheduling::tryScheduleBundle(llvm::ArrayRef<llvm::Value*>, llvm::slpvectorizer::BoUpSLP*, (anonymous namespace)::InstructionsState const&, llvm::slpvectorizer::BoUpSLP::EdgeInfo const&) SLPVectorizer.cpp:0:0\n#15 0x0000556ecc603c24 llvm::slpvectorizer::BoUpSLP::buildTreeRec(llvm::ArrayRef<llvm::Value*>, unsigned int, llvm::slpvectorizer::BoUpSLP::EdgeInfo const&, unsigned int) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x5f57c24)\n#16 0x0000556ecc605f71 llvm::slpvectorizer::BoUpSLP::buildTreeRec(llvm::ArrayRef<llvm::Value*>, unsigned int, llvm::slpvectorizer::BoUpSLP::EdgeInfo const&, unsigned int) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x5f59f71)\n#17 0x0000556ecc606d2a llvm::slpvectorizer::BoUpSLP::buildTreeRec(llvm::ArrayRef<llvm::Value*>, unsigned int, llvm::slpvectorizer::BoUpSLP::EdgeInfo const&, unsigned int)::'lambda'((anonymous namespace)::InstructionsState const&)::operator()((anonymous namespace)::InstructionsState const&) const::'lambda'(llvm::ArrayRef<llvm::Value*>, unsigned int)::operator()(llvm::ArrayRef<llvm::Value*>, unsigned int) const SLPVectorizer.cpp:0:0\n#18 0x0000556ecc607b36 llvm::slpvectorizer::BoUpSLP::buildTreeRec(llvm::ArrayRef<llvm::Value*>, unsigned int, llvm::slpvectorizer::BoUpSLP::EdgeInfo const&, unsigned int)::'lambda'((anonymous namespace)::InstructionsState const&)::operator()((anonymous namespace)::InstructionsState const&) const SLPVectorizer.cpp:0:0\n#19 0x0000556ecc603b4f llvm::slpvectorizer::BoUpSLP::buildTreeRec(llvm::ArrayRef<llvm::Value*>, unsigned int, llvm::slpvectorizer::BoUpSLP::EdgeInfo const&, unsigned int) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x5f57b4f)\n#20 0x0000556ecc605444 llvm::slpvectorizer::BoUpSLP::buildTreeRec(llvm::ArrayRef<llvm::Value*>, unsigned int, llvm::slpvectorizer::BoUpSLP::EdgeInfo const&, unsigned int) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x5f59444)\n#21 0x0000556ecc6054b7 llvm::slpvectorizer::BoUpSLP::buildTreeRec(llvm::ArrayRef<llvm::Value*>, unsigned int, llvm::slpvectorizer::BoUpSLP::EdgeInfo const&, unsigned int) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x5f594b7)\n#22 0x0000556ecc625938 llvm::SLPVectorizerPass::tryToVectorizeList(llvm::ArrayRef<llvm::Value*>, llvm::slpvectorizer::BoUpSLP&, bool) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x5f79938)\n#23 0x0000556ecc62ad80 bool tryToVectorizeSequence<llvm::Value>(llvm::SmallVectorImpl<llvm::Value*>&, llvm::function_ref<bool (llvm::Value*, llvm::Value*)>, llvm::function_ref<bool (llvm::ArrayRef<llvm::Value*>, llvm::Value*)>, llvm::function_ref<bool (llvm::ArrayRef<llvm::Value*>, bool)>, bool, llvm::slpvectorizer::BoUpSLP&) (.constprop.0) SLPVectorizer.cpp:0:0\n#24 0x0000556ecc62bf8b llvm::SLPVectorizerPass::vectorizeChainsInBlock(llvm::BasicBlock*, llvm::slpvectorizer::BoUpSLP&) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x5f7ff8b)\n#25 0x0000556ecc634896 llvm::SLPVectorizerPass::runImpl(llvm::Function&, llvm::ScalarEvolution*, llvm::TargetTransformInfo*, llvm::TargetLibraryInfo*, llvm::AAResults*, llvm::LoopInfo*, llvm::DominatorTree*, llvm::AssumptionCache*, llvm::DemandedBits*, llvm::OptimizationRemarkEmitter*) (.part.0) SLPVectorizer.cpp:0:0\n#26 0x0000556ecc6354ab llvm::SLPVectorizerPass::run(llvm::Function&, llvm::AnalysisManager<llvm::Function>&) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x5f894ab)\n#27 0x0000556ecbb12756 llvm::detail::PassModel<llvm::Function, llvm::SLPVectorizerPass, llvm::AnalysisManager<llvm::Function> >::run(llvm::Function&, llvm::AnalysisManager<llvm::Function>&) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x5466756)\n#28 0x0000556eca39f272 llvm::PassManager<llvm::Function, llvm::AnalysisManager<llvm::Function> >::run(llvm::Function&, llvm::AnalysisManager<llvm::Function>&) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x3cf3272)\n#29 0x0000556ec7a20706 llvm::detail::PassModel<llvm::Function, llvm::PassManager<llvm::Function, llvm::AnalysisManager<llvm::Function> >, llvm::AnalysisManager<llvm::Function> >::run(llvm::Function&, llvm::AnalysisManager<llvm::Function>&) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x1374706)\n#30 0x0000556eca39d119 llvm::ModuleToFunctionPassAdaptor::run(llvm::Module&, llvm::AnalysisManager<llvm::Module>&) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x3cf1119)\n#31 0x0000556ec7a20e46 llvm::detail::PassModel<llvm::Module, llvm::ModuleToFunctionPassAdaptor, llvm::AnalysisManager<llvm::Module> >::run(llvm::Module&, llvm::AnalysisManager<llvm::Module>&) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x1374e46)\n#32 0x0000556eca39de65 llvm::PassManager<llvm::Module, llvm::AnalysisManager<llvm::Module> >::run(llvm::Module&, llvm::AnalysisManager<llvm::Module>&) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x3cf1e65)\n#33 0x0000556ecad36f3a (anonymous namespace)::EmitAssemblyHelper::RunOptimizationPipeline(clang::BackendAction, std::unique_ptr<llvm::raw_pwrite_stream, std::default_delete<llvm::raw_pwrite_stream> >&, std::unique_ptr<llvm::ToolOutputFile, std::default_delete<llvm::ToolOutputFile> >&, clang::BackendConsumer*) BackendUtil.cpp:0:0\n#34 0x0000556ecad3ae53 clang::emitBackendOutput(clang::CompilerInstance&, clang::CodeGenOptions&, llvm::StringRef, llvm::Module*, clang::BackendAction, llvm::IntrusiveRefCntPtr<llvm::vfs::FileSystem>, std::unique_ptr<llvm::raw_pwrite_stream, std::default_delete<llvm::raw_pwrite_stream> >, clang::BackendConsumer*) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x468ee53)\n#35 0x0000556ecb3c8562 clang::BackendConsumer::HandleTranslationUnit(clang::ASTContext&) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x4d1c562)\n#36 0x0000556ecce9f2ac clang::ParseAST(clang::Sema&, bool, bool) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x67f32ac)\n#37 0x0000556ecb6e39f9 clang::FrontendAction::Execute() (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x50379f9)\n#38 0x0000556ecb662a25 clang::CompilerInstance::ExecuteAction(clang::FrontendAction&) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x4fb6a25)\n#39 0x0000556ecb7d8b63 clang::ExecuteCompilerInvocation(clang::CompilerInstance*) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x512cb63)\n#40 0x0000556ec757d2c7 cc1_main(llvm::ArrayRef<char const*>, char const*, void*) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0xed12c7)\n#41 0x0000556ec75736aa ExecuteCC1Tool(llvm::SmallVectorImpl<char const*>&, llvm::ToolContext const&, llvm::IntrusiveRefCntPtr<llvm::vfs::FileSystem>) driver.cpp:0:0\n#42 0x0000556ec757383f int llvm::function_ref<int (llvm::SmallVectorImpl<char const*>&)>::callback_fn<clang_main(int, char**, llvm::ToolContext const&)::'lambda'(llvm::SmallVectorImpl<char const*>&)>(long, llvm::SmallVectorImpl<char const*>&) driver.cpp:0:0\n#43 0x0000556ecb438e5d void llvm::function_ref<void ()>::callback_fn<clang::driver::CC1Command::Execute(llvm::ArrayRef<std::optional<llvm::StringRef> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >*, bool*) const::'lambda'()>(long) Job.cpp:0:0\n#44 0x0000556eca9bb360 llvm::CrashRecoveryContext::RunSafely(llvm::function_ref<void ()>) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x430f360)\n#45 0x0000556ecb4396fe clang::driver::CC1Command::Execute(llvm::ArrayRef<std::optional<llvm::StringRef> >, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >*, bool*) const (.part.0) Job.cpp:0:0\n#46 0x0000556ecb3f6057 clang::driver::Compilation::ExecuteCommand(clang::driver::Command const&, clang::driver::Command const*&, bool) const (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x4d4a057)\n#47 0x0000556ecb3f70f1 clang::driver::Compilation::ExecuteJobs(clang::driver::JobList const&, llvm::SmallVectorImpl<std::pair<int, clang::driver::Command const*> >&, bool) const (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x4d4b0f1)\n#48 0x0000556ecb403d84 clang::driver::Driver::ExecuteCompilation(clang::driver::Compilation&, llvm::SmallVectorImpl<std::pair<int, clang::driver::Command const*> >&) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0x4d57d84)\n#49 0x0000556ec757909b clang_main(int, char**, llvm::ToolContext const&) (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0xecd09b)\n#50 0x0000556ec744116b main (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0xd9516b)\n#51 0x00007f87cde50d90 __libc_start_call_main ./csu/../sysdeps/nptl/libc_start_call_main.h:58:16\n#52 0x00007f87cde50e40 call_init ./csu/../csu/libc-start.c:128:20\n#53 0x00007f87cde50e40 __libc_start_main ./csu/../csu/libc-start.c:379:5\n#54 0x0000556ec7572dc5 _start (/local/home/suz/suz-local/software/local/clang-trunk/bin/clang-22+0xec6dc5)\nclangtk: error: clang frontend command failed with exit code 134 (use -v to see invocation)\nclang version 22.0.0git (https://github.com/llvm/llvm-project.git 5ed26ade0c585d2a081f23546902f64a0366de19)\nTarget: x86_64-unknown-linux-gnu\nThread model: posix\nInstalledDir: /local/home/suz/suz-local/software/local/clang-trunk/bin\nBuild config: +assertions\nclangtk: note: diagnostic msg: \n********************\n\nPLEASE ATTACH THE FOLLOWING FILES TO THE BUG REPORT:\nPreprocessed source(s) and associated run script(s) are located at:\nclangtk: note: diagnostic msg: /tmp/small-cd8076.c\nclangtk: note: diagnostic msg: /tmp/small-cd8076.sh\nclangtk: note: diagnostic msg: \n\n********************\n[515] % \n[515] % cat small.c\nextern int s(int u);\nextern void t(int v);\nint c, f, g = 1, h, i, j, k;\nshort d, e;\nint main() {\n  int m, n = 1, o = 1, b = 0, a = 0;\np:\n  t(m = c < (j && (n = 0)));\n  if ((i - 1) && o < 1)\n    goto p;\n  if (k)\n    goto q;\n  if (!i)\n    goto r;\n  a = 1 / d;\n  b = e;\nr:\n  if (b)\n    f = a;\n  int l = ~(n & e), p = ~(1 & a), q = ~(~p / g ^ ~c), r = ~(d & n);\nah:\n  g = p | r | (l + q);\nq:\n  if (h)\n    goto ah;\n  while (c)\n    if (s(m))\n      goto p;\n    else\n      o = s(0);\n  return 0;\n}\n```\n",
    "author": "zhendongsu",
    "labels": [
      "regression",
      "llvm:SLPVectorizer",
      "crash"
    ],
    "comments": [
      {
        "author": "shafik",
        "body": "Looks like a regression on trunk"
      }
    ]
  },
  "properties": {
    "is_single_file_fix": true,
    "is_single_func_fix": false
  },
  "verified": true
}