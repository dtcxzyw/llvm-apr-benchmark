{
  "bug_id": "104397",
  "issue_url": "https://github.com/llvm/llvm-project/issues/104397",
  "bug_type": "crash",
  "base_commit": "c5b611a419ca8acab041ca52a94c6338bdcd1756",
  "knowledge_cutoff": "2024-08-15T03:47:39Z",
  "lit_test_dir": [
    "llvm/test/Transforms/Attributor/reduced"
  ],
  "hints": {
    "fix_commit": "7156bcf2867f4ca98c8c9166e1ecb77daab08aa5",
    "components": [
      "AttributorAttributes"
    ],
    "bug_location_lineno": {
      "llvm/lib/Transforms/IPO/AttributorAttributes.cpp": [
        [
          1628,
          1633
        ],
        [
          1906,
          1911
        ],
        [
          1916,
          1923
        ]
      ]
    },
    "bug_location_funcname": {
      "llvm/lib/Transforms/IPO/AttributorAttributes.cpp": [
        "AAPointerInfoFloating::updateImpl"
      ]
    }
  },
  "patch": "commit 7156bcf2867f4ca98c8c9166e1ecb77daab08aa5\nAuthor: Johannes Doerfert <johannes@jdoerfert.de>\nDate:   Thu Aug 15 15:45:36 2024 -0700\n\n    [Attributor][FIX] Ensure we do not use stale references (#104495)\n    \n    When copying map entries, we might run into resizing and invalidate the\n    RHS of the assignment. We dealt with this before and now use the proper\n    helper to avoid the problem in another place.\n    \n    Fixes: https://github.com/llvm/llvm-project/issues/104397\n\ndiff --git a/llvm/lib/Transforms/IPO/AttributorAttributes.cpp b/llvm/lib/Transforms/IPO/AttributorAttributes.cpp\nindex 41a7fc0870cf..9f033028347f 100644\n--- a/llvm/lib/Transforms/IPO/AttributorAttributes.cpp\n+++ b/llvm/lib/Transforms/IPO/AttributorAttributes.cpp\n@@ -1628,6 +1628,8 @@ ChangeStatus AAPointerInfoFloating::updateImpl(Attributor &A) {\n                       << \"\\n\");\n     assert(OffsetInfoMap.count(CurPtr) &&\n            \"The current pointer offset should have been seeded!\");\n+    assert(!OffsetInfoMap[CurPtr].isUnassigned() &&\n+           \"Current pointer should be assigned\");\n \n     if (ConstantExpr *CE = dyn_cast<ConstantExpr>(Usr)) {\n       if (CE->isCast())\n@@ -1906,6 +1908,7 @@ ChangeStatus AAPointerInfoFloating::updateImpl(Attributor &A) {\n   };\n   auto EquivalentUseCB = [&](const Use &OldU, const Use &NewU) {\n     assert(OffsetInfoMap.count(OldU) && \"Old use should be known already!\");\n+    assert(!OffsetInfoMap[OldU].isUnassigned() && \"Old use should be assinged\");\n     if (OffsetInfoMap.count(NewU)) {\n       LLVM_DEBUG({\n         if (!(OffsetInfoMap[NewU] == OffsetInfoMap[OldU])) {\n@@ -1916,8 +1919,8 @@ ChangeStatus AAPointerInfoFloating::updateImpl(Attributor &A) {\n       });\n       return OffsetInfoMap[NewU] == OffsetInfoMap[OldU];\n     }\n-    OffsetInfoMap[NewU] = OffsetInfoMap[OldU];\n-    return true;\n+    bool Unused;\n+    return HandlePassthroughUser(NewU.get(), OldU.get(), Unused);\n   };\n   if (!A.checkForAllUses(UsePred, *this, AssociatedValue,\n                          /* CheckBBLivenessOnly */ true, DepClassTy::OPTIONAL,\n",
  "tests": [
    {
      "file": "llvm/test/Transforms/Attributor/reduced/aapointer_info_map_invalidation.ll",
      "commands": [
        "opt -passes=attributor -S < %s"
      ],
      "tests": [
        {
          "test_name": "__omp_offloading_fd00_2c00523__ZN11qmcplusplus7ompBLAS9gemv_implIfEEiRiciiT_PKS3_iS5_iS3_PS3_i_l383",
          "test_body": "define amdgpu_kernel void @__omp_offloading_fd00_2c00523__ZN11qmcplusplus7ompBLAS9gemv_implIfEEiRiciiT_PKS3_iS5_iS3_PS3_i_l383() {\n  %1 = alloca [0 x [0 x float]], i32 0, align 8, addrspace(5)\n  %2 = addrspacecast ptr addrspace(5) %1 to ptr\n  store ptr %2, ptr addrspace(5) %1, align 8\n  %3 = call fastcc i32 @__kmpc_nvptx_parallel_reduce_nowait_v2(ptr %2, i1 false)\n  ret void\n}\n\ndeclare fastcc i32 @__kmpc_nvptx_parallel_reduce_nowait_v2(ptr, i1)\n"
        },
        {
          "test_name": "__kmpc_nvptx_parallel_reduce_nowait_v2",
          "test_body": "define fastcc i32 @__kmpc_nvptx_parallel_reduce_nowait_v2(ptr %0, i1 %1) {\n  br i1 %1, label %3, label %88\n\n3:                                                ; preds = %2\n  %4 = load ptr, ptr %0, align 8\n  br i1 %1, label %5, label %7\n\n5:                                                ; preds = %3\n  %6 = load ptr, ptr %0, align 8\n  store i64 0, ptr %6, align 8\n  br label %79\n\n7:                                                ; preds = %3\n  br i1 %1, label %8, label %11\n\n8:                                                ; preds = %7\n  %9 = load i32, ptr %4, align 4\n  %10 = load ptr, ptr %0, align 8\n  store i32 0, ptr %10, align 4\n  br label %79\n\n11:                                               ; preds = %7\n  br i1 %1, label %12, label %14\n\n12:                                               ; preds = %11\n  %13 = load ptr, ptr %0, align 8\n  store i32 0, ptr %13, align 4\n  br label %79\n\n14:                                               ; preds = %11\n  br i1 %1, label %15, label %17\n\n15:                                               ; preds = %14\n  %16 = load ptr, ptr %0, align 8\n  store i32 0, ptr %16, align 4\n  br label %79\n\n17:                                               ; preds = %14\n  br i1 %1, label %18, label %20\n\n18:                                               ; preds = %17\n  %19 = load ptr, ptr %0, align 8\n  store i32 0, ptr %19, align 4\n  br label %79\n\n20:                                               ; preds = %17\n  br i1 %1, label %21, label %23\n\n21:                                               ; preds = %20\n  %22 = load ptr, ptr %0, align 8\n  store i32 0, ptr %22, align 4\n  br label %79\n\n23:                                               ; preds = %20\n  br i1 %1, label %24, label %26\n\n24:                                               ; preds = %23\n  %25 = load ptr, ptr %0, align 8\n  store i32 0, ptr %25, align 4\n  br label %79\n\n26:                                               ; preds = %23\n  br i1 %1, label %27, label %29\n\n27:                                               ; preds = %26\n  %28 = load ptr, ptr %0, align 8\n  store i32 0, ptr %28, align 8\n  br label %79\n\n29:                                               ; preds = %26\n  br i1 %1, label %30, label %32\n\n30:                                               ; preds = %29\n  %31 = load ptr, ptr %0, align 8\n  store i32 0, ptr %31, align 4\n  br label %79\n\n32:                                               ; preds = %29\n  br i1 %1, label %33, label %35\n\n33:                                               ; preds = %32\n  %34 = load ptr, ptr %0, align 8\n  store i32 0, ptr %34, align 4\n  br label %79\n\n35:                                               ; preds = %32\n  br i1 %1, label %36, label %38\n\n36:                                               ; preds = %35\n  %37 = load ptr, ptr %0, align 8\n  store i32 0, ptr %37, align 4\n  br label %79\n\n38:                                               ; preds = %35\n  br i1 %1, label %39, label %41\n\n39:                                               ; preds = %38\n  %40 = load ptr, ptr %0, align 8\n  store i64 0, ptr %40, align 8\n  br label %79\n\n41:                                               ; preds = %38\n  br i1 %1, label %42, label %44\n\n42:                                               ; preds = %41\n  %43 = load ptr, ptr %0, align 8\n  store i64 0, ptr %43, align 8\n  br label %79\n\n44:                                               ; preds = %41\n  br i1 %1, label %45, label %47\n\n45:                                               ; preds = %44\n  %46 = load ptr, ptr %0, align 8\n  store i32 0, ptr %46, align 4\n  br label %79\n\n47:                                               ; preds = %44\n  br i1 %1, label %48, label %50\n\n48:                                               ; preds = %47\n  %49 = load ptr, ptr %0, align 8\n  store i32 0, ptr %49, align 4\n  br label %79\n\n50:                                               ; preds = %47\n  br i1 %1, label %51, label %53\n\n51:                                               ; preds = %50\n  %52 = load ptr, ptr %0, align 8\n  store i64 0, ptr %52, align 8\n  br label %79\n\n53:                                               ; preds = %50\n  br i1 %1, label %54, label %56\n\n54:                                               ; preds = %53\n  %55 = load ptr, ptr %0, align 8\n  store i64 0, ptr %55, align 8\n  br label %79\n\n56:                                               ; preds = %53\n  br i1 %1, label %57, label %59\n\n57:                                               ; preds = %56\n  %58 = load ptr, ptr %0, align 8\n  store i32 0, ptr %58, align 4\n  br label %79\n\n59:                                               ; preds = %56\n  br i1 %1, label %60, label %62\n\n60:                                               ; preds = %59\n  %61 = load ptr, ptr %0, align 8\n  store i32 0, ptr %61, align 4\n  br label %79\n\n62:                                               ; preds = %59\n  br i1 %1, label %63, label %65\n\n63:                                               ; preds = %62\n  %64 = load ptr, ptr %0, align 8\n  store i64 0, ptr %64, align 8\n  br label %79\n\n65:                                               ; preds = %62\n  br i1 %1, label %66, label %68\n\n66:                                               ; preds = %65\n  %67 = load ptr, ptr %0, align 8\n  store i64 0, ptr %67, align 8\n  br label %79\n\n68:                                               ; preds = %65\n  br i1 %1, label %69, label %71\n\n69:                                               ; preds = %68\n  %70 = load ptr, ptr %0, align 8\n  store i32 0, ptr %70, align 4\n  br label %79\n\n71:                                               ; preds = %68\n  br i1 %1, label %72, label %74\n\n72:                                               ; preds = %71\n  %73 = load ptr, ptr %0, align 8\n  store i32 0, ptr %73, align 4\n  br label %79\n\n74:                                               ; preds = %71\n  br i1 %1, label %75, label %77\n\n75:                                               ; preds = %74\n  %76 = load ptr, ptr %0, align 8\n  store i32 0, ptr %76, align 4\n  br label %79\n\n77:                                               ; preds = %74\n  %78 = load ptr, ptr %0, align 8\n  store i32 0, ptr %78, align 4\n  br label %79\n\n79:                                               ; preds = %77, %75, %72, %69, %66, %63, %60, %57, %54, %51, %48, %45, %42, %39, %36, %33, %30, %27, %24, %21, %18, %15, %12, %8, %5\n  %80 = load ptr, ptr %0, align 8\n  %81 = load i32, ptr %80, align 4\n  %82 = load ptr, ptr %0, align 8\n  store i32 0, ptr %82, align 4\n  %83 = load ptr, ptr %0, align 8\n  %84 = getelementptr i8, ptr %83, i64 4\n  %85 = load ptr, ptr %0, align 8\n  %86 = getelementptr i8, ptr %85, i64 4\n  %87 = load ptr, ptr %0, align 8\n  br i1 %1, label %91, label %93\n\n88:                                               ; preds = %2\n  %89 = load ptr, ptr %0, align 8\n  %90 = load i64, ptr %89, align 8\n  ret i32 0\n\n91:                                               ; preds = %79\n  %92 = load ptr, ptr %0, align 8\n  store i64 0, ptr %92, align 8\n  ret i32 0\n\n93:                                               ; preds = %79\n  br i1 %1, label %94, label %96\n\n94:                                               ; preds = %93\n  %95 = load ptr, ptr %0, align 8\n  store i32 0, ptr %95, align 4\n  ret i32 0\n\n96:                                               ; preds = %93\n  br i1 %1, label %97, label %99\n\n97:                                               ; preds = %96\n  %98 = load ptr, ptr %0, align 8\n  store i32 0, ptr %98, align 4\n  ret i32 0\n\n99:                                               ; preds = %96\n  br i1 %1, label %100, label %102\n\n100:                                              ; preds = %99\n  %101 = load ptr, ptr %0, align 8\n  store i32 0, ptr %101, align 4\n  ret i32 0\n\n102:                                              ; preds = %99\n  br i1 %1, label %103, label %105\n\n103:                                              ; preds = %102\n  %104 = load ptr, ptr %0, align 8\n  store i32 0, ptr %104, align 4\n  ret i32 0\n\n105:                                              ; preds = %102\n  br i1 %1, label %106, label %108\n\n106:                                              ; preds = %105\n  %107 = load ptr, ptr %0, align 8\n  store i32 0, ptr %107, align 4\n  ret i32 0\n\n108:                                              ; preds = %105\n  br i1 %1, label %109, label %111\n\n109:                                              ; preds = %108\n  %110 = load ptr, ptr %0, align 8\n  store i32 0, ptr %110, align 4\n  ret i32 0\n\n111:                                              ; preds = %108\n  br i1 %1, label %112, label %114\n\n112:                                              ; preds = %111\n  %113 = load ptr, ptr %0, align 8\n  store i32 0, ptr %113, align 8\n  ret i32 0\n\n114:                                              ; preds = %111\n  br i1 %1, label %115, label %117\n\n115:                                              ; preds = %114\n  %116 = load ptr, ptr %0, align 8\n  store i32 0, ptr %116, align 4\n  ret i32 0\n\n117:                                              ; preds = %114\n  br i1 %1, label %118, label %121\n\n118:                                              ; preds = %117\n  %119 = load i32, ptr %87, align 4\n  %120 = load ptr, ptr %0, align 8\n  store i32 0, ptr %120, align 4\n  ret i32 0\n\n121:                                              ; preds = %117\n  br i1 %1, label %122, label %124\n\n122:                                              ; preds = %121\n  %123 = load ptr, ptr %0, align 8\n  store i32 0, ptr %123, align 4\n  ret i32 0\n\n124:                                              ; preds = %121\n  br i1 %1, label %125, label %127\n\n125:                                              ; preds = %124\n  %126 = load ptr, ptr %0, align 8\n  store i64 0, ptr %126, align 8\n  ret i32 0\n\n127:                                              ; preds = %124\n  br i1 %1, label %128, label %130\n\n128:                                              ; preds = %127\n  %129 = load ptr, ptr %0, align 8\n  store i64 0, ptr %129, align 8\n  ret i32 0\n\n130:                                              ; preds = %127\n  %131 = load ptr, ptr %0, align 8\n  store i32 0, ptr %131, align 4\n  ret i32 0\n}\n"
        }
      ]
    }
  ],
  "issue": {
    "title": "Running pass \"amdgpu-attributor\" hit assertion",
    "body": "Broken between b68df879c64ac9bb17ce6cc09d5ad86e803a3211 and 4399f2a5ef38df381c2b65052621131890194d59\r\n[reproducer.zip](https://github.com/user-attachments/files/16621312/reproducer.zip)\r\n\r\n```\r\nld.lld: /scratch3/opt/llvm-clang/llvm-project-nightly/llvm/lib/Transforms/IPO/AttributorAttributes.cpp:1686: {anonymous}::AAPointerInfoFloating::updateImpl(llvm::Attributor&)::<lambda(const llvm::Use&, bool&)>: Assertion `!PtrOI.isUnassigned() && \"Cannot assign if the current Ptr was not visited!\"' failed.\r\nPLEASE submit a bug report to https://github.com/llvm/llvm-project/issues/ and include the crash backtrace.\r\nStack dump:\r\n0.\tProgram arguments: /scratch3/packages/llvm/main-20240813/bin/ld.lld --no-undefined -shared --no-undefined /tmp/qmcapp.cpp-amdgcn-amd-amdhsa-gfx1030-d63e3d.o /tmp/CoulombPBCAA.cpp-amdgcn-amd-amdhsa-gfx1030-1f288a.o /tmp/LCAOrbitalSet.cpp-amdgcn-amd-amdhsa-gfx1030-e8039e.o /tmp/MultiQuinticSpline1D.cpp-amdgcn-amd-amdhsa-gfx1030-c00d82.o /tmp/SoaLocalizedBasisSet.cpp-amdgcn-amd-amdhsa-gfx1030-a14a62.o /tmp/HybridRepSetReader.cpp-amdgcn-amd-amdhsa-gfx1030-1a071d.o /tmp/BsplineFunctor.cpp-amdgcn-amd-amdhsa-gfx1030-eb178b.o /tmp/DiracDeterminantBatched.cpp-amdgcn-amd-amdhsa-gfx1030-32b19c.o /tmp/MultiDiracDeterminant.2.cpp-amdgcn-amd-amdhsa-gfx1030-0c3771.o /tmp/SplineC2ROMPTarget.cpp-amdgcn-amd-amdhsa-gfx1030-804f67.o /tmp/MultiSlaterDetTableMethod.cpp-amdgcn-amd-amdhsa-gfx1030-01ac0b.o /tmp/DynamicCoordinatesBuilder.cpp-amdgcn-amd-amdhsa-gfx1030-dfbe54.o /tmp/StructFact.cpp-amdgcn-amd-amdhsa-gfx1030-af2e32.o /tmp/createDistanceTableAAOMPTarget.cpp-amdgcn-amd-amdhsa-gfx1030-b66fe3.o /tmp/createDistanceTableABOMPTarget.cpp-amdgcn-amd-amdhsa-gfx1030-13f689.o /tmp/SoaSphericalTensor.cpp-amdgcn-amd-amdhsa-gfx1030-b5027b.o /tmp/ompBLAS.cpp-amdgcn-amd-amdhsa-gfx1030-3dd2be.o /tmp/devicertl-amdgpu-gfx1030-amdgcn-amd-amdhsa-gfx1030-b26291.o -plugin-opt=mcpu=gfx1030 -o /tmp/qmcpack.amdgcn.gfx1030-f1e811.img\r\n1.\tRunning pass \"amdgpu-attributor\" on module \"ld-temp.o\"\r\n #0 0x0000556f3069e2c0 llvm::sys::PrintStackTrace(llvm::raw_ostream&, int) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x8ab2c0)\r\n #1 0x0000556f3069b6df llvm::sys::RunSignalHandlers() (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x8a86df)\r\n #2 0x0000556f3069b835 SignalHandler(int) Signals.cpp:0:0\r\n #3 0x00007f0972f3c520 (/lib/x86_64-linux-gnu/libc.so.6+0x42520)\r\n #4 0x00007f0972f909fc __pthread_kill_implementation ./nptl/pthread_kill.c:44:76\r\n #5 0x00007f0972f909fc __pthread_kill_internal ./nptl/pthread_kill.c:78:10\r\n #6 0x00007f0972f909fc pthread_kill ./nptl/pthread_kill.c:89:10\r\n #7 0x00007f0972f3c476 gsignal ./signal/../sysdeps/posix/raise.c:27:6\r\n #8 0x00007f0972f227f3 abort ./stdlib/abort.c:81:7\r\n #9 0x00007f0972f2271b _nl_load_domain ./intl/loadmsgcat.c:1177:9\r\n#10 0x00007f0972f33e96 (/lib/x86_64-linux-gnu/libc.so.6+0x39e96)\r\n#11 0x0000556f325de687 (anonymous namespace)::AAPointerInfoFloating::updateImpl(llvm::Attributor&)::'lambda0'(llvm::Use const&, bool&)::operator()(llvm::Use const&, bool&) const AttributorAttributes.cpp:0:0\r\n#12 0x0000556f32553851 llvm::Attributor::checkForAllUses(llvm::function_ref<bool (llvm::Use const&, bool&)>, llvm::AbstractAttribute const&, llvm::Value const&, bool, llvm::DepClassTy, bool, llvm::function_ref<bool (llvm::Use const&, llvm::Use const&)>) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x2760851)\r\n#13 0x0000556f3257a799 (anonymous namespace)::AAPointerInfoFloating::updateImpl(llvm::Attributor&) AttributorAttributes.cpp:0:0\r\n#14 0x0000556f3252c79a llvm::AbstractAttribute::update(llvm::Attributor&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x273979a)\r\n#15 0x0000556f325415ca llvm::Attributor::updateAA(llvm::AbstractAttribute&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x274e5ca)\r\n#16 0x0000556f312a250b llvm::AAPointerInfo const* llvm::Attributor::getOrCreateAAFor<llvm::AAPointerInfo>(llvm::IRPosition, llvm::AbstractAttribute const*, llvm::DepClassTy, bool, bool) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x14af50b)\r\n#17 0x0000556f32559d38 bool llvm::function_ref<bool (llvm::Value&)>::callback_fn<bool getPotentialCopiesOfMemoryValue<true, llvm::LoadInst>(llvm::Attributor&, llvm::LoadInst&, llvm::SmallSetVector<llvm::Value*, 4u>&, llvm::SmallSetVector<llvm::Instruction*, 4u>*, llvm::AbstractAttribute const&, bool&, bool)::'lambda'(llvm::Value&)>(long, llvm::Value&) Attributor.cpp:0:0\r\n#18 0x0000556f3257a3a1 (anonymous namespace)::AAUnderlyingObjectsImpl::forallUnderlyingObjects(llvm::function_ref<bool (llvm::Value&)>, llvm::AA::ValueScope) const AttributorAttributes.cpp:0:0\r\n#19 0x0000556f32545027 bool getPotentialCopiesOfMemoryValue<true, llvm::LoadInst>(llvm::Attributor&, llvm::LoadInst&, llvm::SmallSetVector<llvm::Value*, 4u>&, llvm::SmallSetVector<llvm::Instruction*, 4u>*, llvm::AbstractAttribute const&, bool&, bool) Attributor.cpp:0:0\r\n#20 0x0000556f325cab4d (anonymous namespace)::AAPotentialValuesFloating::updateImpl(llvm::Attributor&) AttributorAttributes.cpp:0:0\r\n#21 0x0000556f3252c79a llvm::AbstractAttribute::update(llvm::Attributor&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x273979a)\r\n#22 0x0000556f325415ca llvm::Attributor::updateAA(llvm::AbstractAttribute&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x274e5ca)\r\n#23 0x0000556f32555dcb llvm::AAPotentialValues const* llvm::Attributor::getOrCreateAAFor<llvm::AAPotentialValues>(llvm::IRPosition, llvm::AbstractAttribute const*, llvm::DepClassTy, bool, bool) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x2762dcb)\r\n#24 0x0000556f325560ae llvm::Attributor::getAssumedSimplifiedValues(llvm::IRPosition const&, llvm::AbstractAttribute const*, llvm::SmallVectorImpl<llvm::AA::ValueAndContext>&, llvm::AA::ValueScope, bool&, bool) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x27630ae)\r\n#25 0x0000556f32556a14 llvm::Attributor::getAssumedSimplified(llvm::IRPosition const&, llvm::AbstractAttribute const*, bool&, llvm::AA::ValueScope) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x2763a14)\r\n#26 0x0000556f325ca77d (anonymous namespace)::AAPotentialValuesFloating::updateImpl(llvm::Attributor&) AttributorAttributes.cpp:0:0\r\n#27 0x0000556f3252c79a llvm::AbstractAttribute::update(llvm::Attributor&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x273979a)\r\n#28 0x0000556f325415ca llvm::Attributor::updateAA(llvm::AbstractAttribute&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x274e5ca)\r\n#29 0x0000556f32555dcb llvm::AAPotentialValues const* llvm::Attributor::getOrCreateAAFor<llvm::AAPotentialValues>(llvm::IRPosition, llvm::AbstractAttribute const*, llvm::DepClassTy, bool, bool) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x2762dcb)\r\n#30 0x0000556f325560ae llvm::Attributor::getAssumedSimplifiedValues(llvm::IRPosition const&, llvm::AbstractAttribute const*, llvm::SmallVectorImpl<llvm::AA::ValueAndContext>&, llvm::AA::ValueScope, bool&, bool) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x27630ae)\r\n#31 0x0000556f32556a14 llvm::Attributor::getAssumedSimplified(llvm::IRPosition const&, llvm::AbstractAttribute const*, bool&, llvm::AA::ValueScope) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x2763a14)\r\n#32 0x0000556f325a011c (anonymous namespace)::AAPointerInfoFloating::updateImpl(llvm::Attributor&)::'lambda0'(llvm::Use const&, bool&)::operator()(llvm::Use const&, bool&) const::'lambda2'(llvm::Instruction&, llvm::Value*, llvm::Type&, llvm::ArrayRef<llvm::Value*>, llvm::AAPointerInfo::AccessKind)::operator()(llvm::Instruction&, llvm::Value*, llvm::Type&, llvm::ArrayRef<llvm::Value*>, llvm::AAPointerInfo::AccessKind) const AttributorAttributes.cpp:0:0\r\n#33 0x0000556f325dde8f (anonymous namespace)::AAPointerInfoFloating::updateImpl(llvm::Attributor&)::'lambda0'(llvm::Use const&, bool&)::operator()(llvm::Use const&, bool&) const AttributorAttributes.cpp:0:0\r\n#34 0x0000556f32553851 llvm::Attributor::checkForAllUses(llvm::function_ref<bool (llvm::Use const&, bool&)>, llvm::AbstractAttribute const&, llvm::Value const&, bool, llvm::DepClassTy, bool, llvm::function_ref<bool (llvm::Use const&, llvm::Use const&)>) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x2760851)\r\n#35 0x0000556f3257a799 (anonymous namespace)::AAPointerInfoFloating::updateImpl(llvm::Attributor&) AttributorAttributes.cpp:0:0\r\n#36 0x0000556f3252c79a llvm::AbstractAttribute::update(llvm::Attributor&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x273979a)\r\n#37 0x0000556f325415ca llvm::Attributor::updateAA(llvm::AbstractAttribute&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x274e5ca)\r\n#38 0x0000556f312a250b llvm::AAPointerInfo const* llvm::Attributor::getOrCreateAAFor<llvm::AAPointerInfo>(llvm::IRPosition, llvm::AbstractAttribute const*, llvm::DepClassTy, bool, bool) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x14af50b)\r\n#39 0x0000556f32559d38 bool llvm::function_ref<bool (llvm::Value&)>::callback_fn<bool getPotentialCopiesOfMemoryValue<true, llvm::LoadInst>(llvm::Attributor&, llvm::LoadInst&, llvm::SmallSetVector<llvm::Value*, 4u>&, llvm::SmallSetVector<llvm::Instruction*, 4u>*, llvm::AbstractAttribute const&, bool&, bool)::'lambda'(llvm::Value&)>(long, llvm::Value&) Attributor.cpp:0:0\r\n#40 0x0000556f3257a3a1 (anonymous namespace)::AAUnderlyingObjectsImpl::forallUnderlyingObjects(llvm::function_ref<bool (llvm::Value&)>, llvm::AA::ValueScope) const AttributorAttributes.cpp:0:0\r\n#41 0x0000556f32545027 bool getPotentialCopiesOfMemoryValue<true, llvm::LoadInst>(llvm::Attributor&, llvm::LoadInst&, llvm::SmallSetVector<llvm::Value*, 4u>&, llvm::SmallSetVector<llvm::Instruction*, 4u>*, llvm::AbstractAttribute const&, bool&, bool) Attributor.cpp:0:0\r\n#42 0x0000556f325cab4d (anonymous namespace)::AAPotentialValuesFloating::updateImpl(llvm::Attributor&) AttributorAttributes.cpp:0:0\r\n#43 0x0000556f3252c79a llvm::AbstractAttribute::update(llvm::Attributor&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x273979a)\r\n#44 0x0000556f325415ca llvm::Attributor::updateAA(llvm::AbstractAttribute&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x274e5ca)\r\n#45 0x0000556f32555dcb llvm::AAPotentialValues const* llvm::Attributor::getOrCreateAAFor<llvm::AAPotentialValues>(llvm::IRPosition, llvm::AbstractAttribute const*, llvm::DepClassTy, bool, bool) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x2762dcb)\r\n#46 0x0000556f325560ae llvm::Attributor::getAssumedSimplifiedValues(llvm::IRPosition const&, llvm::AbstractAttribute const*, llvm::SmallVectorImpl<llvm::AA::ValueAndContext>&, llvm::AA::ValueScope, bool&, bool) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x27630ae)\r\n#47 0x0000556f32556a14 llvm::Attributor::getAssumedSimplified(llvm::IRPosition const&, llvm::AbstractAttribute const*, bool&, llvm::AA::ValueScope) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x2763a14)\r\n#48 0x0000556f325ca77d (anonymous namespace)::AAPotentialValuesFloating::updateImpl(llvm::Attributor&) AttributorAttributes.cpp:0:0\r\n#49 0x0000556f3252c79a llvm::AbstractAttribute::update(llvm::Attributor&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x273979a)\r\n#50 0x0000556f325415ca llvm::Attributor::updateAA(llvm::AbstractAttribute&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x274e5ca)\r\n#51 0x0000556f32555dcb llvm::AAPotentialValues const* llvm::Attributor::getOrCreateAAFor<llvm::AAPotentialValues>(llvm::IRPosition, llvm::AbstractAttribute const*, llvm::DepClassTy, bool, bool) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x2762dcb)\r\n#52 0x0000556f325560ae llvm::Attributor::getAssumedSimplifiedValues(llvm::IRPosition const&, llvm::AbstractAttribute const*, llvm::SmallVectorImpl<llvm::AA::ValueAndContext>&, llvm::AA::ValueScope, bool&, bool) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x27630ae)\r\n#53 0x0000556f325e11d7 (anonymous namespace)::AAUnderlyingObjectsImpl::updateImpl(llvm::Attributor&)::'lambda'(llvm::SmallSetVector<llvm::Value*, 8u>&, llvm::AA::ValueScope)::operator()(llvm::SmallSetVector<llvm::Value*, 8u>&, llvm::AA::ValueScope) const AttributorAttributes.cpp:0:0\r\n#54 0x0000556f325e23b6 (anonymous namespace)::AAUnderlyingObjectsImpl::updateImpl(llvm::Attributor&) AttributorAttributes.cpp:0:0\r\n#55 0x0000556f3252c79a llvm::AbstractAttribute::update(llvm::Attributor&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x273979a)\r\n#56 0x0000556f325415ca llvm::Attributor::updateAA(llvm::AbstractAttribute&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x274e5ca)\r\n#57 0x0000556f32544063 llvm::AAUnderlyingObjects const* llvm::Attributor::getOrCreateAAFor<llvm::AAUnderlyingObjects>(llvm::IRPosition, llvm::AbstractAttribute const*, llvm::DepClassTy, bool, bool) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x2751063)\r\n#58 0x0000556f325e0eff (anonymous namespace)::AAAddressSpaceImpl::updateImpl(llvm::Attributor&) AttributorAttributes.cpp:0:0\r\n#59 0x0000556f3252c79a llvm::AbstractAttribute::update(llvm::Attributor&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x273979a)\r\n#60 0x0000556f325415ca llvm::Attributor::updateAA(llvm::AbstractAttribute&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x274e5ca)\r\n#61 0x0000556f3129fcbb llvm::AAAddressSpace const* llvm::Attributor::getOrCreateAAFor<llvm::AAAddressSpace>(llvm::IRPosition, llvm::AbstractAttribute const*, llvm::DepClassTy, bool, bool) (.isra.0) AMDGPUAttributor.cpp:0:0\r\n#62 0x0000556f312a51a8 (anonymous namespace)::runImpl(llvm::Module&, llvm::AnalysisGetter&, llvm::TargetMachine&, llvm::AMDGPUAttributorOptions) (.constprop.0) AMDGPUAttributor.cpp:0:0\r\n#63 0x0000556f312a5af2 llvm::AMDGPUAttributorPass::run(llvm::Module&, llvm::AnalysisManager<llvm::Module>&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x14b2af2)\r\n#64 0x0000556f3104a4c6 llvm::detail::PassModel<llvm::Module, llvm::AMDGPUAttributorPass, llvm::AnalysisManager<llvm::Module>>::run(llvm::Module&, llvm::AnalysisManager<llvm::Module>&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x12574c6)\r\n#65 0x0000556f33d1a52d llvm::PassManager<llvm::Module, llvm::AnalysisManager<llvm::Module>>::run(llvm::Module&, llvm::AnalysisManager<llvm::Module>&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x3f2752d)\r\n#66 0x0000556f31ce334c runNewPMPasses(llvm::lto::Config const&, llvm::Module&, llvm::TargetMachine*, unsigned int, bool, llvm::ModuleSummaryIndex*, llvm::ModuleSummaryIndex const*) LTOBackend.cpp:0:0\r\n#67 0x0000556f31ce4db8 llvm::lto::opt(llvm::lto::Config const&, llvm::TargetMachine*, unsigned int, llvm::Module&, bool, llvm::ModuleSummaryIndex*, llvm::ModuleSummaryIndex const*, std::vector<unsigned char, std::allocator<unsigned char>> const&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x1ef1db8)\r\n#68 0x0000556f31ce76bc llvm::lto::backend(llvm::lto::Config const&, std::function<llvm::Expected<std::unique_ptr<llvm::CachedFileStream, std::default_delete<llvm::CachedFileStream>>> (unsigned int, llvm::Twine const&)>, unsigned int, llvm::Module&, llvm::ModuleSummaryIndex&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x1ef46bc)\r\n#69 0x0000556f31cda0f6 llvm::lto::LTO::runRegularLTO(std::function<llvm::Expected<std::unique_ptr<llvm::CachedFileStream, std::default_delete<llvm::CachedFileStream>>> (unsigned int, llvm::Twine const&)>) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x1ee70f6)\r\n#70 0x0000556f31cda603 llvm::lto::LTO::run(std::function<llvm::Expected<std::unique_ptr<llvm::CachedFileStream, std::default_delete<llvm::CachedFileStream>>> (unsigned int, llvm::Twine const&)>, std::function<llvm::Expected<std::function<llvm::Expected<std::unique_ptr<llvm::CachedFileStream, std::default_delete<llvm::CachedFileStream>>> (unsigned int, llvm::Twine const&)>> (unsigned int, llvm::StringRef, llvm::Twine const&)>) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x1ee7603)\r\n#71 0x0000556f30890367 lld::elf::BitcodeCompiler::compile() (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0xa9d367)\r\n#72 0x0000556f307da677 void lld::elf::LinkerDriver::compileBitcodeFiles<llvm::object::ELFType<(llvm::endianness)1, true>>(bool) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x9e7677)\r\n#73 0x0000556f307f6fc2 void lld::elf::LinkerDriver::link<llvm::object::ELFType<(llvm::endianness)1, true>>(llvm::opt::InputArgList&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0xa03fc2)\r\n#74 0x0000556f307fe864 lld::elf::LinkerDriver::linkerMain(llvm::ArrayRef<char const*>) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0xa0b864)\r\n#75 0x0000556f308003b0 lld::elf::link(llvm::ArrayRef<char const*>, llvm::raw_ostream&, llvm::raw_ostream&, bool, bool) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0xa0d3b0)\r\n#76 0x0000556f306d7610 lld::unsafeLldMain(llvm::ArrayRef<char const*>, llvm::raw_ostream&, llvm::raw_ostream&, llvm::ArrayRef<lld::DriverDef>, bool) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x8e4610)\r\n#77 0x0000556f30610cc6 lld_main(int, char**, llvm::ToolContext const&) (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x81dcc6)\r\n#78 0x0000556f3055075b main (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x75d75b)\r\n#79 0x00007f0972f23d90 __libc_start_call_main ./csu/../sysdeps/nptl/libc_start_call_main.h:58:16\r\n#80 0x00007f0972f23e40 call_init ./csu/../csu/libc-start.c:128:20\r\n#81 0x00007f0972f23e40 __libc_start_main ./csu/../csu/libc-start.c:379:5\r\n#82 0x0000556f30610525 _start (/scratch3/packages/llvm/main-20240813/bin/ld.lld+0x81d525)\r\n```\r\n",
    "author": "ye-luo",
    "labels": [
      "crash",
      "llvm::Attributor"
    ],
    "comments": []
  }
}